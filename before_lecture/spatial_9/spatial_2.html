<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Peter Ganong and Maggie Shi">

<title>Spatial II</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="spatial_2_files/libs/clipboard/clipboard.min.js"></script>
<script src="spatial_2_files/libs/quarto-html/quarto.js"></script>
<script src="spatial_2_files/libs/quarto-html/popper.min.js"></script>
<script src="spatial_2_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="spatial_2_files/libs/quarto-html/anchor.min.js"></script>
<link href="spatial_2_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="spatial_2_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="spatial_2_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="spatial_2_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="spatial_2_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Spatial II</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Peter Ganong and Maggie Shi </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">today</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<!-- ---
title: "Spatial II"
author: "Peter Ganong and Maggie Shi"
date: today
date-format: long
execute: 
    echo: true
format:
    beamer:
        toc: true
        fig-height: 2.5
        include-in-header: header_pagenrs.tex
include-before-body:
  text: |
    \RecustomVerbatimEnvironment{verbatim}{Verbatim}{
      showspaces = false,
      showtabs = false,
      breaksymbolleft={},
      breaklines
    }
    
--- -->
<section id="introduction-to-data-structures-in-geopandas-6.2" class="level1">
<h1>Introduction to data structures in geopandas (6.2)</h1>
<section id="geopandas-roadmap" class="level2">
<h2 class="anchored" data-anchor-id="geopandas-roadmap">Geopandas roadmap</h2>
<p>In practice, we won’t be coding our geodata by hand… Instead we are going to use shapefiles!</p>
<div id="3d72d9f9" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Roadmap</p>
<ul>
<li>Vocabulary</li>
<li>File formats</li>
<li>Read in data</li>
<li>Preview data</li>
</ul>
</section>
<section id="define-vocabulary" class="level2">
<h2 class="anchored" data-anchor-id="define-vocabulary">Define vocabulary</h2>
<p>Vocabulary</p>
<ul>
<li>A <code>GeoDataFrame</code> is basically like a <code>pandas.DataFrame</code> that contains dedicated columns for storing geometries.
<ul>
<li>We will start with examples with a single column and later teach you how to use more than one column</li>
</ul></li>
<li>That column is called a <code>GeoSeries</code>. This can be any of data types (point, line, polygon) from the prior section. All of the methods you saw in the last section can also be used on a <code>GeoSeries</code></li>
</ul>
</section>
<section id="file-format-i-shapefile" class="level2">
<h2 class="anchored" data-anchor-id="file-format-i-shapefile">File format I: Shapefile</h2>
<ul>
<li>consists of at least three files <code>.shp</code> has feature geometrics, <code>.shx</code> has a positional index, <code>.dbf</code> has attribute information</li>
<li>Usually also have <code>.prj</code> which describes the Coordinate Reference System (CRS)</li>
<li>When you read in <code>map.shp</code> it automatically reads the rest of them as well to give you proper GeoDataFrame composed of geometry, attributes and projection.</li>
</ul>
</section>
<section id="coordinate-reference-systems" class="level2">
<h2 class="anchored" data-anchor-id="coordinate-reference-systems">Coordinate Reference Systems</h2>
<ul>
<li>Coordinate Reference System (CRS) is a combination of:
<ul>
<li>“Datum”: origin of latitude and longitude</li>
<li>“Project”: representation of curved surface onto flat map</li>
</ul></li>
<li>Most common CRS: WGS84 (used for GPS)</li>
<li>All coordinates are consistent <em>within</em> a CRS, but not always <em>across</em> CRS’s</li>
<li>Different CRS’s suit different needs
<ul>
<li>optimized for local vs.&nbsp;global accuracy</li>
<li>different approaches to approx. shape of the earth</li>
<li>distance is measured in different units: degrees, miles, meters</li>
</ul></li>
<li>Each system is associated with a unique <em>EPSG code</em>. Searchable on <a href="https://epsg.io">https://epsg.io</a>
<ul>
<li>(Aside: EPSG stands for European Petroleum Survey Group)</li>
<li>These codes are used to convert one CRS into another</li>
</ul></li>
</ul>
<!-- ZZZZ here I would go to the epsg link and search up WGS84 to show that it is EPSG number 4326. https://epsg.io/4326. 
Then you can look up "Illinois" and show that there are Illinois-east and Illinois-west-specific CRS's. 
The skill they should learn is what a CRS is and how to look up the EPSG numbers so that they can transform from one CRS to another: https://geopandas.org/en/stable/docs/reference/api/geopandas.GeoDataFrame.to_crs.html  -->
</section>
<section id="reading-a-shapefile-.shp" class="level2">
<h2 class="anchored" data-anchor-id="reading-a-shapefile-.shp">Reading a Shapefile <code>.shp</code></h2>
<div id="abc70fd6" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#in same dir:  `.shx` and `.dbf`</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>filepath <span class="op">=</span> <span class="st">"data/shp/austin_pop_2019.shp"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> gpd.read_file(filepath)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="file-format-ii-geopackage" class="level2">
<h2 class="anchored" data-anchor-id="file-format-ii-geopackage">File format II: GeoPackage</h2>
<ul>
<li>single file <code>.gpkg</code></li>
<li>Supports both raster and vector data</li>
<li>Efficiently decodable by software, particularly in mobile devices</li>
</ul>
<p>GeoPackage is more modern, but you will encounter shapefiles everywhere you look so good to be familiar with it.</p>
</section>
<section id="reading-a-geopackage-gpkg" class="level2">
<h2 class="anchored" data-anchor-id="reading-a-geopackage-gpkg">Reading a GeoPackage <code>gpkg</code></h2>
<div id="f43356e5" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>filepath <span class="op">=</span> <span class="st">"data/austin_pop_2019.gpkg"</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> gpd.read_file(filepath)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>geopandas.geodataframe.GeoDataFrame</code></pre>
</div>
</div>
</section>
<section id="previewing-a-geodataframe" class="level2">
<h2 class="anchored" data-anchor-id="previewing-a-geodataframe">Previewing a <code>GeoDataFrame</code></h2>
<div id="123fe4c0" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">pop2019</th>
<th data-quarto-table-cell-role="th">tract</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>6070.0</td>
<td>002422</td>
<td>POLYGON ((615643.487 3338728.496, 615645.477 3...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2203.0</td>
<td>001751</td>
<td>POLYGON ((618576.586 3359381.053, 618614.33 33...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>7419.0</td>
<td>002411</td>
<td>POLYGON ((619200.163 3341784.654, 619270.849 3...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4229.0</td>
<td>000401</td>
<td>POLYGON ((621623.757 3350508.165, 621656.294 3...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>4589.0</td>
<td>002313</td>
<td>POLYGON ((621630.247 3345130.744, 621717.926 3...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="previewing-a-geoseries" class="level2">
<h2 class="anchored" data-anchor-id="previewing-a-geoseries">Previewing a <code>GeoSeries</code></h2>
<div id="50655156" class="cell" data-fig-height="3" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>data.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="spatial_2_files/figure-html/cell-6-output-1.png" width="329" height="425" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Discussion question: Why isn’t it enough to just to <code>head()</code>?</p>
<!-- ZZZ solution: because WKT isn't intellgible to you for sanity checking. But seeing an actual map is. Also, note that the WKT are not comparable to the WKT we saw in examples earlier because they're on different coordinate reference systems? -->
</section>
<section id="geopandas-summary" class="level2">
<h2 class="anchored" data-anchor-id="geopandas-summary">Geopandas summary</h2>
<ul>
<li><code>GeoDataFrame</code> and <code>GeoSeries</code> are the counterparts of <code>pandas.DataFrame</code> and <code>pandas.Series</code></li>
<li><code>.shp</code> and <code>.gpkg</code> are two ways of storing geo data</li>
<li>Always plot your map before you do anything else</li>
</ul>
</section>
</section>
<section id="geometries-in-geopandas-6.2" class="level1">
<h1>Geometries in geopandas (6.2)</h1>
<section id="geometries-roadmap" class="level2">
<h2 class="anchored" data-anchor-id="geometries-roadmap">geometries: roadmap</h2>
<ul>
<li>methods applied to <code>GeoSeries</code></li>
<li>my first choropleth</li>
</ul>
<!-- MS to GGG: fixed small typo throughout - it's "choropleth," not "chloropleth." Before I taught spatial I also could have sworn it was called chloropleth too! -->
</section>
<section id="geoseries" class="level2">
<h2 class="anchored" data-anchor-id="geoseries"><code>GeoSeries</code></h2>
<div id="607c075c" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(data[<span class="st">"geometry"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>geopandas.geoseries.GeoSeries</code></pre>
</div>
</div>
<!--PG note to self: textbook uses inconsistent syntax for extracting geometry in different places. I have made it consistent to improve clarity-->
</section>
<section id="head" class="level2">
<h2 class="anchored" data-anchor-id="head"><code>head()</code></h2>
<div id="c5bd679e" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">"geometry"</span>].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>0    POLYGON ((615643.487 3338728.496, 615645.477 3...
1    POLYGON ((618576.586 3359381.053, 618614.33 33...
2    POLYGON ((619200.163 3341784.654, 619270.849 3...
3    POLYGON ((621623.757 3350508.165, 621656.294 3...
4    POLYGON ((621630.247 3345130.744, 621717.926 3...
Name: geometry, dtype: geometry</code></pre>
</div>
</div>
</section>
<section id="calculate-area-in-km2" class="level2">
<h2 class="anchored" data-anchor-id="calculate-area-in-km2">calculate area (in km^2)</h2>
<div id="e0a8bdc7" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">"geometry"</span>].area</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>0      4.029772e+06
1      1.532030e+06
2      3.960344e+06
3      2.181762e+06
4      2.431208e+06
           ...     
125    2.321182e+06
126    4.388407e+06
127    1.702764e+06
128    3.540893e+06
129    2.054702e+06
Length: 130, dtype: float64</code></pre>
</div>
</div>
</section>
<section id="add-column-to-data-frame" class="level2">
<h2 class="anchored" data-anchor-id="add-column-to-data-frame">add column to data frame</h2>
<div id="d4f663bf" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#data.area is just a shorthand for data.geometry.area</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>data[<span class="st">"area_km2"</span>] <span class="op">=</span> data.area <span class="op">/</span> <span class="dv">1000000</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">pop2019</th>
<th data-quarto-table-cell-role="th">tract</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">area_km2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>6070.0</td>
<td>002422</td>
<td>POLYGON ((615643.487 3338728.496, 615645.477 3...</td>
<td>4.029772</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2203.0</td>
<td>001751</td>
<td>POLYGON ((618576.586 3359381.053, 618614.33 33...</td>
<td>1.532030</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>7419.0</td>
<td>002411</td>
<td>POLYGON ((619200.163 3341784.654, 619270.849 3...</td>
<td>3.960344</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4229.0</td>
<td>000401</td>
<td>POLYGON ((621623.757 3350508.165, 621656.294 3...</td>
<td>2.181762</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>4589.0</td>
<td>002313</td>
<td>POLYGON ((621630.247 3345130.744, 621717.926 3...</td>
<td>2.431208</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<!-- MS to GGG: how do we know that the area is in meters? -->
</section>
<section id="my-first-choropleth" class="level2">
<h2 class="anchored" data-anchor-id="my-first-choropleth">my first choropleth</h2>
<div id="1b97156f" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>data.plot(column<span class="op">=</span><span class="st">"area_km2"</span>, legend<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="spatial_2_files/figure-html/cell-11-output-1.png" width="375" height="425" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Why is this a nearly useless set of colors? <!--Usually we do choropleths based on attributes. Will do this in the next section of lecture.--></p>
</section>
<section id="geometries-summary" class="level2">
<h2 class="anchored" data-anchor-id="geometries-summary">geometries: summary</h2>
<ul>
<li>can do all the same operations on a <code>GeoSeries</code> that you would do on any other polygon, like <code>Area</code></li>
<li><code>data.plot(column="var")</code> draws a choropleth map with shading corresponding to the highlighted variable</li>
</ul>
</section>
</section>
<section id="common-geometric-operations-6.3" class="level1">
<h1>Common geometric operations (6.3)</h1>
<section id="common-geometric-operations-roadmap" class="level2">
<h2 class="anchored" data-anchor-id="common-geometric-operations-roadmap">common geometric operations: roadmap</h2>
<ul>
<li>load and explore data</li>
<li>methods
<ul>
<li>centroid</li>
<li>bounding box</li>
<li>buffer</li>
<li>dissolve</li>
<li>spatial join</li>
</ul></li>
<li>do-pair-share</li>
</ul>
</section>
<section id="austin-continued" class="level2">
<h2 class="anchored" data-anchor-id="austin-continued">Austin, continued</h2>
<p>(The textbook uses a slightly different file here, unclear why.)</p>
<div id="31e86749" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>filepath <span class="op">=</span> <span class="st">"data/austin_pop_density_2019.gpkg"</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> gpd.read_file(filepath)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="explore-the-data-i" class="level2">
<h2 class="anchored" data-anchor-id="explore-the-data-i">explore the data I</h2>
<div id="a5c3cfa9" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">pop2019</th>
<th data-quarto-table-cell-role="th">tract</th>
<th data-quarto-table-cell-role="th">area_km2</th>
<th data-quarto-table-cell-role="th">pop_density_km2</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>6070.0</td>
<td>002422</td>
<td>4.029772</td>
<td>1506.288778</td>
<td>MULTIPOLYGON (((615643.488 3338728.496, 615645...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2203.0</td>
<td>001751</td>
<td>1.532030</td>
<td>1437.961394</td>
<td>MULTIPOLYGON (((618576.586 3359381.053, 618614...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>7419.0</td>
<td>002411</td>
<td>3.960344</td>
<td>1873.322161</td>
<td>MULTIPOLYGON (((619200.163 3341784.654, 619270...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4229.0</td>
<td>000401</td>
<td>2.181762</td>
<td>1938.341859</td>
<td>MULTIPOLYGON (((621623.757 3350508.165, 621656...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>4589.0</td>
<td>002313</td>
<td>2.431208</td>
<td>1887.538658</td>
<td>MULTIPOLYGON (((621630.247 3345130.744, 621717...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="explore-the-data-ii" class="level2">
<h2 class="anchored" data-anchor-id="explore-the-data-ii">explore the data II</h2>
<div id="5249ef50" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(data[<span class="st">"geometry"</span>].values[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>shapely.geometry.multipolygon.MultiPolygon</code></pre>
</div>
</div>
</section>
<section id="explore-the-data-iii" class="level2">
<h2 class="anchored" data-anchor-id="explore-the-data-iii">explore the data III</h2>
<div id="86f4fb56" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>data.plot(facecolor<span class="op">=</span><span class="st">"none"</span>, linewidth<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">"off"</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="spatial_2_files/figure-html/cell-15-output-1.png" width="265" height="389" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Import <code>matplotlib.pyplot</code> to access additional plotting options (e.g., x and y labels, title)</li>
<li>We turn the axis off because the WKT is not particularly informative</li>
</ul>
</section>
<section id="explore-the-data-iv" class="level2">
<h2 class="anchored" data-anchor-id="explore-the-data-iv">explore the data IV</h2>
<div id="a65e0aee" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>data.plot(column<span class="op">=</span><span class="st">"pop_density_km2"</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">"off"</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="spatial_2_files/figure-html/cell-16-output-1.png" width="265" height="389" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><code>facecolor</code> (or <code>fc</code> or <code>color</code>) defines a uniform color across all geometries</li>
<li>whereas <code>columns</code> generates colors based on the underlying values</li>
</ul>
</section>
<section id="methods-centroid-i" class="level2">
<h2 class="anchored" data-anchor-id="methods-centroid-i">methods: centroid I</h2>
<p>What it is: arithmetic mean position of all the points in a polygon <!-- MS to GGG: this used to read "arithmetic mean position of all the points in the surface of the figure", but I think "polygons" is more accurate? --></p>
<p>Sample use case: measuring distance between center of each multipolygon</p>
<div id="6f1e4b9f" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">"geometry"</span>].centroid.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>0     POINT (616990.19 3339736.002)
1    POINT (619378.303 3359650.002)
2    POINT (620418.753 3342194.171)
3    POINT (622613.506 3351414.386)
4    POINT (622605.359 3343869.554)
dtype: geometry</code></pre>
</div>
</div>
</section>
<section id="methods-centroid-ii" class="level2">
<h2 class="anchored" data-anchor-id="methods-centroid-ii">methods: centroid II</h2>
<div id="382f3615" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>data.centroid.plot(markersize<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">"off"</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="spatial_2_files/figure-html/cell-18-output-1.png" width="253" height="389" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="methods-bounding-box-definition" class="level2">
<h2 class="anchored" data-anchor-id="methods-bounding-box-definition">methods: bounding box definition</h2>
<p>What it is: the tightest possible rectangle around a shape, capturing all of its points within this rectangle.</p>
<p>Sample use case: filtering a larger spatial dataset to subset of interest</p>
</section>
<section id="methods-bounding-box-for-each-polygon-i" class="level2">
<h2 class="anchored" data-anchor-id="methods-bounding-box-for-each-polygon-i">methods: bounding box for each polygon I</h2>
<div id="1186ce0a" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>data.envelope.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>0    POLYGON ((615643.488 3337909.895, 618358.033 3...
1    POLYGON ((618529.497 3358797, 620192.632 33587...
2    POLYGON ((619198.456 3340875.421, 621733.88 33...
3    POLYGON ((621599.087 3350329.32, 623714.365 33...
4    POLYGON ((621630.247 3343015.679, 624133.189 3...
dtype: geometry</code></pre>
</div>
</div>
</section>
<section id="methods-bounding-box-for-each-polygon-ii" class="level2">
<h2 class="anchored" data-anchor-id="methods-bounding-box-for-each-polygon-ii">methods: bounding box for each polygon II</h2>
<div id="37f6d881" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>data.envelope.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="spatial_2_files/figure-html/cell-20-output-1.png" width="329" height="425" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="methods-bounding-box-for-whole-data-i" class="level2">
<h2 class="anchored" data-anchor-id="methods-bounding-box-for-whole-data-i">methods: bounding box for whole data I</h2>
<div id="a53b64e0" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>data.total_bounds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>array([ 608125.39429998, 3337909.89499998,  629828.38850021,
       3370513.68260002])</code></pre>
</div>
</div>
</section>
<section id="methods-bounding-box-for-whole-data-ii" class="level2">
<h2 class="anchored" data-anchor-id="methods-bounding-box-for-whole-data-ii">methods: bounding box for whole data II</h2>
<p>Flashback to section 6.1</p>
<div id="88adda8b" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely <span class="im">import</span> Point, Polygon</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>point1 <span class="op">=</span> Point(data.total_bounds[<span class="dv">0</span>], data.total_bounds[<span class="dv">1</span>])</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>point2 <span class="op">=</span> Point(data.total_bounds[<span class="dv">2</span>], data.total_bounds[<span class="dv">1</span>])</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>point3 <span class="op">=</span> Point(data.total_bounds[<span class="dv">2</span>], data.total_bounds[<span class="dv">3</span>])</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>point4 <span class="op">=</span> Point(data.total_bounds[<span class="dv">0</span>], data.total_bounds[<span class="dv">3</span>])</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>poly <span class="op">=</span> Polygon([point1, point2, point3, point4])</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co">#poly</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><em>Note</em>: the order in which you put these points together matters, and you’ll get all sorts of interesting shapes with different orders!</li>
</ul>
<!-- PG to MS:
1. data.union_all().envelope should also work, but it is throwing an error for me, I'm curious if it works for you
2. One fun thing I learned by accident is that if you put the points in a different order that you get all sorts of interesting shapes. Not sure we really care about this, but could be a fun short in-class exercise

MS to GGG: I'm getting "AttributeError: 'GeoDataFrame' object has no attribute 'union_all'"
Very odd since there's documentation for it... https://geopandas.org/en/latest/docs/reference/api/geopandas.GeoSeries.union_all.html

I added a line on that second point!
-->
</section>
<section id="methods-buffer-i" class="level2">
<h2 class="anchored" data-anchor-id="methods-buffer-i">methods: buffer I</h2>
<p>What it is: shape representing all points that are less than a certain distance from the original shape</p>
<p>Sample use case: how many stores or parks near a neighborhood</p>
<!-- CC additional suggestion for motivations which I did not include for space reasons
* geometries that don’t line up. Coasts are a moving target. Some geometries will go out into the water. Others will have a well-defined coast. 
* Also for selecting for the spatial relationships
-->
</section>
<section id="methods-buffer-ii" class="level2">
<h2 class="anchored" data-anchor-id="methods-buffer-ii">methods: buffer II</h2>
<div id="4d4a9a6e" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>data.<span class="bu">buffer</span>(<span class="dv">1000</span>).plot(edgecolor<span class="op">=</span><span class="st">"white"</span>) <span class="co">#1000 meters</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">"off"</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="spatial_2_files/figure-html/cell-23-output-1.png" width="272" height="389" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="methods-dissolve-i" class="level2">
<h2 class="anchored" data-anchor-id="methods-dissolve-i">methods: dissolve I</h2>
<p>What it is: combining geometries into coarser spatial units based on some attributes.</p>
<p>Sample use case: construct the geometries that you want to serve with public transit</p>
<div id="d7def4df" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new column and add a constant value</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>data[<span class="st">"dense"</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter rows with above average pop density and update the column dense</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>data.loc[data[<span class="st">"pop_density_km2"</span>] <span class="op">&gt;</span> data[<span class="st">"pop_density_km2"</span>].mean(), <span class="st">"dense"</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>data.dense.value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>dense
0    86
1    44
Name: count, dtype: int64</code></pre>
</div>
</div>
<!-- MS to GGG: this would be a great discussion question (if the comment was removed): what is that line of code doing? Why would this relate to the sample use described above? Answer: say the city can only serve half of the areas with public transit and wants to create a map with just those areas combined.-->
</section>
<section id="methods-dissolve-ii" class="level2">
<h2 class="anchored" data-anchor-id="methods-dissolve-ii">methods: dissolve II</h2>
<div id="62e1d954" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>dissolved <span class="op">=</span> data[[<span class="st">"pop2019"</span>, <span class="st">"area_km2"</span>, <span class="st">"dense"</span>, <span class="st">"geometry"</span>]].dissolve(</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    by<span class="op">=</span><span class="st">"dense"</span>, aggfunc<span class="op">=</span><span class="st">"sum"</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co">#aggregation step set index to "dense", reset to default</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>dissolved <span class="op">=</span> dissolved.reset_index()</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>dissolved</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">dense</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">pop2019</th>
<th data-quarto-table-cell-role="th">area_km2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0</td>
<td>MULTIPOLYGON (((614108.23 3339640.551, 614288....</td>
<td>368992.0</td>
<td>231.131494</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>MULTIPOLYGON (((612263.531 3338931.8, 612265.2...</td>
<td>242943.0</td>
<td>71.234570</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<ul>
<li>Aggregating alters the way the data is indexed and makes the grouping variable the index</li>
<li>We need to reset it in order to plot, since some plotting libraries expect data to be indexed in a specific way</li>
</ul>
<!--
PG to MS not sure if we need more detail here. If you want more detail see the conversation here, but that feels like TMI
https://chatgpt.com/share/66eb10ee-3a10-800a-bee6-89851e220d69

MS to GGG: I was a little confused, so I added in the bullets above. 
-->
</section>
<section id="methods-dissolve-iii" class="level2">
<h2 class="anchored" data-anchor-id="methods-dissolve-iii">methods: dissolve III</h2>
<div id="09ef8f7e" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>dissolved.plot(column<span class="op">=</span><span class="st">"dense"</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">"off"</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="spatial_2_files/figure-html/cell-26-output-1.png" width="265" height="389" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Discussion Question: is this a good map? What can we do to improve it?</p>
<!-- ZZZ: no -- the reader has no idea what purple and yellow mean. It would be better if we added a legend that indicates that purple areas are above-median in population density while yellow is below-median. -->
</section>
<section id="methods-spatial-join" class="level2">
<h2 class="anchored" data-anchor-id="methods-spatial-join">methods: spatial join</h2>
<p>Spatial join: find the closest neighbor.</p>
<p>(Contrived) example: Join Austin tracts to themselves. How many tracts should we expect to get?</p>
<div id="1e7265b7" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>data_for_join <span class="op">=</span> data[[<span class="st">"tract"</span>, <span class="st">"geometry"</span>]]</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"N tracts "</span> <span class="op">+</span> <span class="bu">str</span>(<span class="bu">len</span>(data_for_join)))</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>join_to_self <span class="op">=</span> gpd.sjoin_nearest(data_for_join, data_for_join, how<span class="op">=</span><span class="st">'inner'</span>, distance_col<span class="op">=</span><span class="st">"distance"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>N tracts 130</code></pre>
</div>
</div>
</section>
<section id="methods-spatial-join-ii" class="level2">
<h2 class="anchored" data-anchor-id="methods-spatial-join-ii">methods: spatial join II</h2>
<div id="f0f0688b" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"N tracts w closest neighbor "</span> <span class="op">+</span> <span class="bu">str</span>(<span class="bu">len</span>(join_to_self)))</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>join_to_self.head(<span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>N tracts w closest neighbor 848</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="28">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">tract_left</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">index_right</th>
<th data-quarto-table-cell-role="th">tract_right</th>
<th data-quarto-table-cell-role="th">distance</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>002422</td>
<td>MULTIPOLYGON (((615643.488 3338728.496, 615645...</td>
<td>92</td>
<td>002423</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>002422</td>
<td>MULTIPOLYGON (((615643.488 3338728.496, 615645...</td>
<td>0</td>
<td>002422</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>002422</td>
<td>MULTIPOLYGON (((615643.488 3338728.496, 615645...</td>
<td>26</td>
<td>002424</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>002422</td>
<td>MULTIPOLYGON (((615643.488 3338728.496, 615645...</td>
<td>78</td>
<td>002402</td>
<td>0.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="common-geometric-operations-summary" class="level2">
<h2 class="anchored" data-anchor-id="common-geometric-operations-summary">common geometric operations: summary</h2>
<ul>
<li>methods
<ul>
<li>centroid computes arithmetic mean of points in the polygon</li>
<li>bounding box expands polygon in a rectangle</li>
<li>buffer expands polygon in every direction</li>
<li>dissolve combines several polygons</li>
<li>spatial join finds nearest neighbor</li>
</ul></li>
<li>do-pair-share</li>
</ul>
</section>
<section id="do-pair-share" class="level2">
<h2 class="anchored" data-anchor-id="do-pair-share">do pair share</h2>
<p>Goal: Create and plot a 500m buffer zone around the dense areas in Austin.</p>
<p>Steps</p>
<ol type="1">
<li>From the <code>dissolved</code> <code>GeoDataFrame</code>, get the polygon for the dense areas</li>
<li>Create a new geometry object called <code>geo</code>, which is the dense areas with a 500m buffer</li>
<li><code>geo.plot()</code></li>
</ol>
<p>After you are done, here are some cosmetic suggestions:</p>
<ul>
<li>Start with a grey plot of all of the Austin boundaries: <code>austin = data.plot(color="grey")</code></li>
<li>Make your buffer transparent</li>
<li>Putting it all together <code>geo.plot(ax = austin, alpha=0.5)</code>
<ul>
<li>This plots the <code>geo</code> object with 50% transparency, on top of axes based on the <code>austin</code> object</li>
</ul></li>
</ul>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>